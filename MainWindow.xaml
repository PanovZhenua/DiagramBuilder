<Window x:Class="DiagramBuilder.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Редактор диаграмм IDEF0 / FEO / NodeTree / IDEF3 / DFD"
        Height="850"
        Width="1600"
        WindowState="Maximized">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Панель управления -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Background="#2C3E50">
            <Button x:Name="BtnLoad"
                    Content="📂 Загрузить"
                    Width="120"
                    Height="35"
                    Margin="5"
                    Background="#3498DB"
                    Foreground="White"
                    FontWeight="Bold"
                    Click="LoadFromText_Click"
                    IsTabStop="False"
                    Focusable="False"/>

            <Button x:Name="BtnClear"
                    Content="🗑️ Очистить"
                    Width="120"
                    Height="35"
                    Margin="5"
                    Background="#E74C3C"
                    Foreground="White"
                    FontWeight="Bold"
                    Click="Clear_Click"
                    IsTabStop="False"
                    Focusable="False"/>

            <Button x:Name="BtnExport"
                    Content="💾 Экспорт"
                    Width="120"
                    Height="35"
                    Margin="5"
                    Background="#27AE60"
                    Foreground="White"
                    FontWeight="Bold"
                    Click="Export_Click"
                    IsTabStop="False"
                    Focusable="False"/>

            <Separator Width="20" Background="Transparent"/>

            <CheckBox x:Name="ChkLockBlocks"
                      Content="🔒 Блокировать блоки"
                      Foreground="White"
                      VerticalAlignment="Center"
                      Margin="10,0"
                      Checked="ChkLockBlocks_Changed"
                      Unchecked="ChkLockBlocks_Changed"
                      IsTabStop="False"
                      Focusable="False"/>

            <CheckBox x:Name="ChkLockLabels"
                      Content="🔒 Блокировать подписи"
                      Foreground="White"
                      VerticalAlignment="Center"
                      Margin="10,0"
                      Checked="ChkLockLabels_Changed"
                      Unchecked="ChkLockLabels_Changed"
                      IsTabStop="False"
                      Focusable="False"
                      IsChecked="True"/>

            <CheckBox x:Name="ChkSnapToGrid"
                      Content="🧲 Магнит (15px)"
                      Foreground="White"
                      VerticalAlignment="Center"
                      Margin="10,0"
                      Checked="ChkSnapToGrid_Changed"
                      Unchecked="ChkSnapToGrid_Changed"
                      IsChecked="True"
                      IsTabStop="False"
                      Focusable="False"/>

            <TextBlock Text="Стиль:"
                       Foreground="White"
                       VerticalAlignment="Center"
                       Margin="15,0,5,0"/>

            <ComboBox x:Name="StyleComboBox"
                      Width="220"
                      Height="35"
                      Margin="5"
                      VerticalContentAlignment="Center"
                      HorizontalContentAlignment="Center"
                      FontWeight="Bold"
                      SelectionChanged="StyleComboBox_SelectionChanged">
                <!-- Элементы заполняются в коде, но можно оставить дефолт -->
                <ComboBoxItem Content="ClassicBlackWhite" Tag="ClassicBlackWhite"/>
                <ComboBoxItem Content="SoftPastel" Tag="SoftPastel"/>
                <ComboBoxItem Content="Presentation" Tag="Presentation"/>
                <ComboBoxItem Content="Blueprint" Tag="Blueprint"/>
            </ComboBox>
        </StackPanel>

        <!-- Центральная область: текст + канвас -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="320"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Текстовая область -->
            <Border Grid.Column="0"
                    Margin="5"
                    Background="#34495E"
                    BorderBrush="#2C3E50"
                    BorderThickness="2">
                <TextBox x:Name="DiagramTextBox"
                         TextWrapping="NoWrap"
                         AcceptsReturn="True"
                         VerticalScrollBarVisibility="Auto"
                         HorizontalScrollBarVisibility="Auto"
                         FontFamily="Consolas"
                         FontSize="12"
                         Padding="10"
                         Background="#2C3E50"
                         Foreground="White"
                         MouseDown="DiagramTextBox_MouseDown"/>
            </Border>

            <!-- Область рисования -->
            <Border Grid.Column="1"
                    Margin="5"
                    Background="White"
                    BorderBrush="#BDC3C7"
                    BorderThickness="2">
                <ScrollViewer x:Name="CanvasScrollViewer"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto"
                              Focusable="True"
                              PreviewMouseWheel="CanvasScrollViewer_PreviewMouseWheel"
                              PreviewMouseDown="CanvasScrollViewer_PreviewMouseDown"
                              PreviewMouseMove="CanvasScrollViewer_PreviewMouseMove"
                              PreviewMouseUp="CanvasScrollViewer_PreviewMouseUp">
                    <Canvas x:Name="DiagramCanvas"
                            MinWidth="4000"
                            MinHeight="4000"
                            Background="White"
                            Focusable="True">
                        <Canvas.LayoutTransform>
                            <ScaleTransform x:Name="CanvasScaleTransform"
                                            ScaleX="1.0"
                                            ScaleY="1.0"/>
                        </Canvas.LayoutTransform>
                    </Canvas>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Статус-бар -->
        <StatusBar Grid.Row="2"
                   Background="#2C3E50"
                   Height="30">
            <StatusBarItem>
                <TextBlock x:Name="TxtStatus"
                           Text="Готов к работе"
                           Foreground="White"
                           FontWeight="Bold"/>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Тип: "
                               Foreground="White"/>
                    <TextBlock x:Name="TxtDiagramType"
                               Text="IDEF0"
                               Foreground="#3498DB"
                               FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Блоков: "
                               Foreground="White"/>
                    <TextBlock x:Name="TxtBlockCount"
                               Text="0"
                               Foreground="#27AE60"
                               FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Стрелок: "
                               Foreground="White"/>
                    <TextBlock x:Name="TxtArrowCount"
                               Text="0"
                               Foreground="#E67E22"
                               FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>

            <Separator/>

            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Масштаб: "
                               Foreground="White"/>
                    <TextBlock x:Name="TxtZoomLevel"
                               Text="100%"
                               Foreground="#9B59B6"
                               FontWeight="Bold"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
